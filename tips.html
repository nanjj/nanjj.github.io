<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-11-26 äºŒ 00:12 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tips</title>
<meta name="generator" content="Org mode" />
<link rel="stylesheet" type="text/css" href="css/org.css" />
</head>
<body>
<div id="content">
<h1 class="title">Tips</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org3f57c95">Linux Kernel</a>
<ul>
<li><a href="#orgc484c32">Mount tmpfs</a></li>
<li><a href="#orga7dcf18">Enable ccache</a></li>
<li><a href="#org3fc5f01">Enable distcc</a></li>
<li><a href="#org7048186">Build</a></li>
</ul>
</li>
<li><a href="#org8e08f72">Ssh</a>
<ul>
<li><a href="#org0e5595c">Using SSH Multiplexing</a></li>
</ul>
</li>
<li><a href="#org163c6ef">QEMU</a>
<ul>
<li><a href="#org910a7d9">which nic models qemu supports?</a></li>
<li><a href="#org51dcd45">Quit qemu <code>C-A C</code>.</a></li>
</ul>
</li>
<li><a href="#orgd8242fe">Ncat</a>
<ul>
<li><a href="#org8694c51">Install</a></li>
<li><a href="#org4596620">Transfer Single File</a></li>
<li><a href="#orga9ff923">Transfer Multiple Files</a></li>
<li><a href="#org3e73a9b">Http Proxy</a></li>
<li><a href="#org086ae72">Proxy Ssh</a></li>
<li><a href="#orgbd30f97">Proxy Ansible</a></li>
</ul>
</li>
<li><a href="#orgf0f1190">Permission Bits</a></li>
</ul>
</div>
</div>

<div id="outline-container-org3f57c95" class="outline-2">
<h2 id="org3f57c95">Linux Kernel</h2>
<div class="outline-text-2" id="text-org3f57c95">
<p>
Kernel building takes too long time. We can use below methods
together to speed up the process:
</p>

<ol class="org-ol">
<li>Enable <code>tmpfs</code> to build in memory,</li>
<li>Enable <code>ccache</code> to avoid unnecessary recompile,</li>
<li>Enable <code>distcc</code> to build on multiple machines.</li>
</ol>
</div>

<div id="outline-container-orgc484c32" class="outline-3">
<h3 id="orgc484c32">Mount tmpfs</h3>
<div class="outline-text-3" id="text-orgc484c32">
<div class="org-src-container">
<pre class="src src-sh">mkdir src .ccache
mount -t tmpfs -o <span style="color: #fcaf3e;">size</span>=30G,<span style="color: #fcaf3e;">mode</span>=0755 tmpfs src
mount -t tmpfs -o <span style="color: #fcaf3e;">size</span>=10G,<span style="color: #fcaf3e;">mode</span>=0755 tmpfs .ccache
</pre>
</div>
<p>
Speed up kernel building via <code>ccache</code> and <code>distcc</code>:
</p>
</div>
</div>

<div id="outline-container-orga7dcf18" class="outline-3">
<h3 id="orga7dcf18">Enable ccache</h3>
<div class="outline-text-3" id="text-orga7dcf18">
<div class="org-src-container">
<pre class="src src-sh">apt-get install ccache
</pre>
</div>
</div>
</div>

<div id="outline-container-org3fc5f01" class="outline-3">
<h3 id="org3fc5f01">Enable distcc</h3>
<div class="outline-text-3" id="text-org3fc5f01">
<div class="org-src-container">
<pre class="src src-sh">apt-get install distcc
<span style="color: #e090d7;">echo</span> 10.113.111.160 10.113.111.187 &gt;&gt; /etc/distcc/hosts
</pre>
</div>

<p>
On <code>10.113.111.160</code> and  <code>10.113.111.187</code>:
</p>

<div class="org-src-container">
<pre class="src src-sh">apt-get install distcc
cat &gt; /etc/default/distcc &lt;&lt;EOF
<span style="color: #ffff00; font-weight: bold;">STARTDISTCC="true"</span>
<span style="color: #ffff00; font-weight: bold;">ALLOWEDNETS="10.113.111.152"    # master build ip</span>
<span style="color: #ffff00; font-weight: bold;">LISTENER="10.113.111.187"       # local ip</span>
<span style="color: #ffff00; font-weight: bold;">EOF</span>
systemctl restart distcc
</pre>
</div>
</div>
</div>
<div id="outline-container-org7048186" class="outline-3">
<h3 id="org7048186">Build</h3>
<div class="outline-text-3" id="text-org7048186">
<p>
Build ubuntu kernel <code>Ubuntu-4.4.0-102.125</code> as below:
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #e090d7;">cd</span> src
git clone git://kernel.ubuntu.com/ubuntu/ubuntu-xenial
<span style="color: #e090d7;">cd</span> ubuntu-xenial
git checkout Ubuntu-4.4.0-102.125
sed <span style="color: #e9b96e;">'s/CONFIG_VIRTIO_NET=y/CONFIG_VIRTIO_NET=m/g'</span>
<span style="color: #e090d7;">export</span> <span style="color: #fcaf3e;">PATH</span>=/usr/lib/ccache:$<span style="color: #fcaf3e;">PATH</span>
<span style="color: #e090d7;">export</span> <span style="color: #fcaf3e;">CCACHE_PREFIX</span>=<span style="color: #e9b96e;">"distcc"</span>
fakeroot debian/rules clean
fakeroot debian/rules binary
</pre>
</div>

<p>
It takes around 9 minutes on my machine.
</p>
</div>
</div>
</div>


<div id="outline-container-org8e08f72" class="outline-2">
<h2 id="org8e08f72">Ssh</h2>
<div class="outline-text-2" id="text-org8e08f72">
</div>
<div id="outline-container-org0e5595c" class="outline-3">
<h3 id="org0e5595c"><a href="https://blog.scottlowe.org/2015/12/11/using-ssh-multiplexing/">Using SSH Multiplexing</a></h3>
<div class="outline-text-3" id="text-org0e5595c">
<pre class="example">
ControlMaster auto
ControlPath ~/.ssh/sockets/%r@%h-%p
ControlPersist 600
</pre>
</div>
</div>
</div>

<div id="outline-container-org163c6ef" class="outline-2">
<h2 id="org163c6ef">QEMU</h2>
<div class="outline-text-2" id="text-org163c6ef">
</div>
<div id="outline-container-org910a7d9" class="outline-3">
<h3 id="org910a7d9">which nic models qemu supports?</h3>
<div class="outline-text-3" id="text-org910a7d9">
<div class="org-src-container">
<pre class="src src-sh">qemu-system-x86_64 -net nic,<span style="color: #fcaf3e;">model</span>=?
<span style="color: #73d216;">#</span><span style="color: #73d216;">=&gt;</span>
qemu: Supported NIC models: ne2k_pci,i82551,i82557b,i82559er,rtl8139,e1000,pcnet,virtio
</pre>
</div>
</div>
</div>
<div id="outline-container-org51dcd45" class="outline-3">
<h3 id="org51dcd45">Quit qemu <code>C-A C</code>.</h3>
</div>
</div>

<div id="outline-container-orgd8242fe" class="outline-2">
<h2 id="orgd8242fe">Ncat</h2>
<div class="outline-text-2" id="text-orgd8242fe">
<p>
<a href="https://nmap.org/ncat/">Ncat</a> is a general-purpose command-line tool for reading, writing,
redirecting, and encrypting data across a network. It is along with
<a href="https://nmap.org/">nmap</a>, but not so famous.
</p>
</div>

<div id="outline-container-org8694c51" class="outline-3">
<h3 id="org8694c51">Install</h3>
<div class="outline-text-3" id="text-org8694c51">
<p>
To install ncat just install nmap, Ubuntu:
</p>
<pre class="example">
apt-get install nmap
</pre>

<p>
Mac:
</p>

<pre class="example">
brew install nmap
</pre>

<p>
Here some tips from me.
</p>
</div>
</div>

<div id="outline-container-org4596620" class="outline-3">
<h3 id="org4596620">Transfer Single File</h3>
<div class="outline-text-3" id="text-org4596620">
<p>
Transfer single file:
</p>

<pre class="example">
# on machine A
ncat -p 80 -l --send-only &lt; file
# on machine B
ncat &lt;machine A ip&gt; 80 --recv-only &gt; file
</pre>
</div>
</div>

<div id="outline-container-orga9ff923" class="outline-3">
<h3 id="orga9ff923">Transfer Multiple Files</h3>
<div class="outline-text-3" id="text-orga9ff923">
<p>
Transfer multiple files:
</p>

<pre class="example">
# on machine A
for file in *.deb; do
    echo $file | ncat -p 80 -l --send-only
    ncat -p 80 -l --send-only &lt; $file
done
# on machine B
while true; do
    file=$(ncat &lt;machine A ip&gt; 80 --recv-only) || break
    echo $file
    ncat &lt;machine A ip&gt; 80 --recv-only &gt; $file
done
</pre>
</div>
</div>

<div id="outline-container-org3e73a9b" class="outline-3">
<h3 id="org3e73a9b">Http Proxy</h3>
<div class="outline-text-3" id="text-org3e73a9b">
<p>
Ncat can act as a http proxy server, which
</p>

<p>
Run:
</p>

<pre class="example">
ncat -l -p 8888 --proxy-type http --allow 127.0.0.1
</pre>

<p>
Test it(on the machine running ncat):
</p>

<pre class="example">
export https_proxy=http://127.0.0.1:8888
curl https://www.google.com
</pre>

<p>
Jump over the wall via ssh:
</p>

<pre class="example">
ssh -L 127.0.0.1:8888:127.0.0.1:8888 &lt;your machine outside the wall&gt;
</pre>

<p>
Test it again(on the machine running <code>ssh -L</code>):
</p>

<pre class="example">
export http_proxy=http://127.0.0.1:8888
curl http://www.google.com
</pre>

<p>
Http request will go through your local port 8888, encrypted and
jump over the wall, go to your target machine local port 8888, via
ncat to access the world. It's safe, simple, stable and fast.
</p>
</div>
</div>

<div id="outline-container-org086ae72" class="outline-3">
<h3 id="org086ae72">Proxy Ssh</h3>
<div class="outline-text-3" id="text-org086ae72">
<p>
Ncat http proxy mode support <code>CONNECT</code> method also. So it can be
used as a ssh proxy:
</p>

<pre class="example">
ssh -o "ProxyCommand=ncat --proxy 127.0.0.1:8888 %h %p" user@host
</pre>

<p>
Ssh traffic will go to your local port 8888, ssh will forward it to
your jumpbox, which ncat is running there, to visit all the machines
running behind the jumpbox. In this way, you can keep your ssh keys
in your local, no need to copy anywhere in order to access your
machines.
</p>

<p>
You can put it to your <code>~/.ssh/config</code>:
</p>

<pre class="example">
Host: host
Hostname: host
ProxyCommand: ncat --proxy 127.0.0.1:8888 %h %p
</pre>
</div>
</div>

<div id="outline-container-orgbd30f97" class="outline-3">
<h3 id="orgbd30f97">Proxy Ansible</h3>
<div class="outline-text-3" id="text-orgbd30f97">
<p>
You can run ansible with below configuration in your inventory:
</p>

<pre class="example">
[all:vars]
ansible_ssh_common_args='-o ProxyCommand="ncat --proxy 127.0.0.1:8888 %h %p"'
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf0f1190" class="outline-2">
<h2 id="orgf0f1190">Permission Bits</h2>
<div class="outline-text-2" id="text-orgf0f1190">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> Read, write and execute permissions</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Permission</th>
<th scope="col" class="org-right">Octal</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">rwx</td>
<td class="org-right">7</td>
<td class="org-left">Read, write and execute</td>
</tr>

<tr>
<td class="org-left">rw-</td>
<td class="org-right">6</td>
<td class="org-left">Read and write</td>
</tr>

<tr>
<td class="org-left">r-x</td>
<td class="org-right">5</td>
<td class="org-left">Read and execute</td>
</tr>

<tr>
<td class="org-left">r--</td>
<td class="org-right">4</td>
<td class="org-left">Read</td>
</tr>

<tr>
<td class="org-left">-wx</td>
<td class="org-right">3</td>
<td class="org-left">Write and execute</td>
</tr>

<tr>
<td class="org-left">-w-</td>
<td class="org-right">2</td>
<td class="org-left">Write</td>
</tr>

<tr>
<td class="org-left">&#x2013;x</td>
<td class="org-right">1</td>
<td class="org-left">Execute</td>
</tr>

<tr>
<td class="org-left">---</td>
<td class="org-right">0</td>
<td class="org-left">no permissions</td>
</tr>
</tbody>
</table>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 2:</span> User, group and others</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Permission</th>
<th scope="col" class="org-right">Octal</th>
<th scope="col" class="org-left">Field</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">rwx------</td>
<td class="org-right">0700</td>
<td class="org-left">User</td>
</tr>

<tr>
<td class="org-left">&#x2014;rwx---</td>
<td class="org-right">0070</td>
<td class="org-left">Group</td>
</tr>

<tr>
<td class="org-left">-&#x2013;&#x2014;rwx</td>
<td class="org-right">0007</td>
<td class="org-left">All Others</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</body>
</html>
